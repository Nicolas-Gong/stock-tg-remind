# 📈 Telegram股票价格提醒机器人

一个功能完整的Telegram机器人，用于实时监控股票价格变化并发送提醒通知。

## ✨ 功能特点

- 🔔 **实时提醒**：每60秒自动检查股票价格变化
- 📊 **多种提醒类型**：
  - 价格变化提醒：几分钟内涨跌幅超过设定百分比
  - 今日涨跌幅提醒：当日整体涨跌幅超过设定百分比
- ⏰ **可配置提醒频率**：设置每几分钟最多提醒一次，避免过多通知
- 💾 **文件缓存存储**：使用JSON文件存储提醒数据和股票缓存
- 🔄 **数据缓存**：6秒内有效的数据缓存，减少API调用
- 👥 **多用户支持**：每个用户独立管理自己的提醒列表

## 🚀 快速开始

### 1. 环境准备

确保你有Python 3.7+环境：

```bash
python --version
```

### 2. 安装依赖

```bash
pip install -r requirements.txt
```

### 3. 获取Telegram机器人令牌

1. 在Telegram中找到 [@BotFather](https://t.me/botfather)
2. 发送 `/newbot` 命令
3. 按照提示创建机器人并获取API令牌

### 4. 配置机器人

编辑 `config.json` 文件，将 `YOUR_TELEGRAM_BOT_TOKEN` 替换为你的实际令牌：

```json
{
  "telegram_token": "你的机器人令牌",
  "data_file": "stock_data.json",
  "cache_file": "stock_cache.json",
  "check_interval": 60,
  "timeout": 10,
  "cache_expiry_seconds": 6
}
```

### 5. 启动机器人

```bash
python start_bot.py
```

或者直接运行主程序：

```bash
python stock_bot.py
```

## 📱 使用方法

### 基本命令

- `/start` - 开始使用机器人
- `/help` - 查看帮助信息
- `/add` - 添加股票提醒
- `/list` - 查看我的提醒列表
- `/remove` - 移除提醒

### 添加提醒示例

```
# 添加价格变化提醒（每5分钟检查一次）
/add 600000 价格变化 2 5

# 添加今日涨跌幅提醒
/add 000001 今日涨跌 5

# 添加提醒（使用默认5分钟间隔）
/add 000002 价格变化 3
```

### 参数说明

`/add <股票代码> <提醒类型> <阈值%> [时间间隔分钟]`

- **股票代码**：如 600000、000001等
- **提醒类型**：
  - `价格变化`：监控最近几分钟内的价格变化
  - `今日涨跌`：监控今日整体涨跌幅
- **阈值**：触发提醒的百分比（如 2 表示2%）
- **时间间隔**：两次提醒之间的最短间隔（分钟），默认5分钟

### 查看和管理提醒

```bash
/list     # 查看所有提醒
/remove 1 # 移除第一个提醒
```

## 🔧 配置说明

### 主要配置项

- `telegram_token`：Telegram机器人API令牌（必需）
- `data_file`：提醒数据存储文件
- `cache_file`：股票数据缓存文件
- `check_interval`：检查提醒的时间间隔（秒）
- `timeout`：请求超时时间（秒）
- `cache_expiry_seconds`：股票数据缓存过期时间（秒），默认6秒

### 数据存储

- `stock_data.json`：存储用户的提醒设置
- `stock_cache.json`：缓存股票价格数据（6秒有效期）

## 📊 股票数据API

已集成腾讯财经API (`http://qt.gtimg.cn/q=sh600519`)，自动解析实时股票数据。

### 支持的股票市场

- **上海股市**：代码以`6`开头，如 `600519` (茅台)
- **深圳股市**：代码以`0`或`3`开头，如 `000001` (平安银行)
- **港股市场**：5位数字代码，如 `00001` (长和)
- **美股市场**：字母代码，如 `AAPL` (苹果)、`TSLA` (特斯拉)

### API数据格式

腾讯财经API返回的数据格式为用`~`分隔的字符串，包含完整的股票信息：

```
v_sh600519="1~茅台~600519~1422.90~1429.10~1429.10~23578~9135~14438~1422.90~1~1422.87~5~...";
```

### 解析后的数据结构

```json
{
  "code": "600519",
  "name": "茅台",
  "current_price": 1422.90,
  "prev_close": 1429.10,
  "open_price": 1429.10,
  "high_price": 1432.50,
  "low_price": 1418.38,
  "change": -6.20,
  "change_percent": -0.43,
  "timestamp": "2024-01-01T09:30:00"
}
```

## 🛠️ 开发说明

### 项目结构

```
.
├── stock_bot.py      # 主程序文件
├── start_bot.py      # 启动脚本
├── config.json       # 配置文件
├── requirements.txt  # 依赖文件
├── stock_data.json   # 提醒数据（运行时生成）
├── stock_cache.json  # 缓存数据（运行时生成）
└── README.md         # 说明文档
```

### 主要类说明

- `StockBot`：Telegram机器人主类，处理用户命令
- `AlertManager`：提醒管理器，负责添加、删除、检查提醒
- `StockDataFetcher`：股票数据获取器，支持缓存
- `StockCache`：数据缓存管理器

### 扩展功能

你可以根据需要扩展以下功能：

1. **更多提醒类型**：如成交量提醒、均线突破等
2. **更多股票市场**：港股、美股等
3. **图表支持**：发送股票K线图
4. **用户权限**：VIP用户特殊功能
5. **数据源**：接入多个股票数据提供商

## ⚠️ 注意事项

1. **API限制**：注意股票API的调用频率限制
2. **数据准确性**：确保使用的股票数据API可靠准确
3. **隐私保护**：提醒数据本地存储，不上传到服务器
4. **稳定性**：机器人会自动重试失败的请求

## 📄 许可证

MIT License

## 🤝 贡献

欢迎提交Issue和Pull Request来改进这个项目！

---

如有问题，请查看日志输出或提交Issue。
